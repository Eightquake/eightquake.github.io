<html>
	<head>
		<title>Visualisation</title>
		<meta charset="UTF-8">
		<style>
			body {
				width:100%;
				height:100%;
				margin:0;
			}
		</style>
		<script>
			var canvas, context, acontext;
			var count = 1024;
			var acontext, audio, asrc, analyser, frequencyData;
			var staples = [];
			window.onresize = function() {
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			}
			window.onload = function() {
				canvas = document.getElementById("canvas");
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
				context = canvas.getContext("2d"); // canvas context
				
				
				acontext = new AudioContext(); // audio context
				audio = document.getElementById("audio");
				audio.volume = 1;
				asrc = acontext.createMediaElementSource(audio);
				analyser = acontext.createAnalyser();
				asrc.connect(acontext.destination);
				asrc.connect(analyser);
				
				frequencyData = new Uint8Array(analyser.frequencyBinCount);
				render();
				audio.play();
			}
			function render() {
				requestAnimationFrame(render);
				
				context.clearRect(0, 0, canvas.width, canvas.height);
				context.fillStyle="#333";
				context.fillRect(0, 0, canvas.width, canvas.height);
				
				context.fillStyle="#FFF";
				analyser.getByteFrequencyData(frequencyData);
				var z = 0;
				for(var i=0;i<frequencyData.length-20;i+=20) {
					z++;
					staples[z] = (frequencyData[i]+frequencyData[i+1]+frequencyData[i+2]+frequencyData[i+3]+frequencyData[i+4]+frequencyData[i+5]+frequencyData[i+6]+frequencyData[i+7]+frequencyData[i+8]+frequencyData[i+9]+frequencyData[i+10]+frequencyData[i+11]+frequencyData[i+12]+frequencyData[i+13]+frequencyData[i+14]+frequencyData[i+15]+frequencyData[i+16]+frequencyData[i+17]+frequencyData[i+18]+frequencyData[i+19])/20;
				}
				for(var i=0;i<staples.length;i++) {
					context.fillRect(i*(canvas.width/(staples.length)), canvas.height-100, Math.round(canvas.width/(staples.length)-1), -staples[i]*2+2);
				}
			}
		</script>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<audio id="audio" src="songs/apollo.mp3"></audio>
	</body>
<html>